---
import LayoutSidebar from '../../../app/LayoutSidebar.astro';
---

<LayoutSidebar>
	<div class="px-4 pt-6">
		<div class="mb-4">
			<h1 class="text-2xl font-bold text-gray-900 dark:text-white">Nuevo Cliente</h1>
			<p class="text-gray-600 dark:text-gray-400">Registrar un nuevo cliente</p>
		</div>

		<div class="p-6 bg-white border border-gray-200 rounded-lg shadow dark:bg-gray-800 dark:border-gray-700">
			<form id="formCliente" class="space-y-6">
				<div class="grid grid-cols-1 gap-6 sm:grid-cols-2">
					<div>
						<label
							for="dni"
							class="block mb-2 text-sm font-medium text-gray-900 dark:text-white"
							>DNI *</label
						>
						<input
							type="text"
							id="dni"
							name="dni"
							maxlength="8"
							required
							class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500"
							placeholder="12345678"
						/>
					</div>
					<div>
						<label
							for="nombres"
							class="block mb-2 text-sm font-medium text-gray-900 dark:text-white"
							>Nombres *</label
						>
						<input
							type="text"
							id="nombres"
							name="nombres"
							required
							class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500"
							placeholder="Juan"
						/>
					</div>
					<div>
						<label
							for="apellidos"
							class="block mb-2 text-sm font-medium text-gray-900 dark:text-white"
							>Apellidos *</label
						>
						<input
							type="text"
							id="apellidos"
							name="apellidos"
							required
							class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500"
							placeholder="Pérez"
						/>
					</div>
					<div>
						<label
							for="telefono"
							class="block mb-2 text-sm font-medium text-gray-900 dark:text-white"
							>Teléfono</label
						>
						<input
							type="tel"
							id="telefono"
							name="telefono"
							class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500"
							placeholder="+51 999 999 999"
						/>
					</div>
					<div>
						<label
							for="correo"
							class="block mb-2 text-sm font-medium text-gray-900 dark:text-white"
							>Correo Electrónico</label
						>
						<input
							type="email"
							id="correo"
							name="correo"
							class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500"
							placeholder="cliente@ejemplo.com"
						/>
					</div>
					<div>
						<label
							for="estado"
							class="block mb-2 text-sm font-medium text-gray-900 dark:text-white"
							>Estado *</label
						>
						<select
							id="estado"
							name="estado"
							required
							class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500"
						>
							<option value="activo">Activo</option>
							<option value="inactivo">Inactivo</option>
						</select>
					</div>
				</div>
				<div class="flex gap-4">
					<button
						type="submit"
						class="text-white bg-blue-700 hover:bg-blue-800 focus:ring-4 focus:ring-blue-300 font-medium rounded-lg text-sm px-5 py-2.5 dark:bg-blue-600 dark:hover:bg-blue-700"
					>
						Guardar Cliente
					</button>
					<a
						href="/crud/clientes"
						class="text-gray-900 bg-white border border-gray-300 hover:bg-gray-100 focus:ring-4 focus:ring-gray-200 font-medium rounded-lg text-sm px-5 py-2.5 dark:bg-gray-800 dark:text-white dark:border-gray-600 dark:hover:bg-gray-700"
					>
						Cancelar
					</a>
				</div>
			</form>
		</div>
	</div>
</LayoutSidebar>

<script>
	document.getElementById('formCliente')?.addEventListener('submit', async (e) => {
		e.preventDefault();
		const formData = new FormData(e.target);
		const data = {
			dni: formData.get('dni'),
			nombres: formData.get('nombres'),
			apellidos: formData.get('apellidos'),
			telefono: formData.get('telefono') || null,
			correo: formData.get('correo') || null,
			estado: formData.get('estado')
		};

		try {
			const response = await fetch('http://localhost:8081/api/clientes', {
				method: 'POST',
				headers: {
					'Content-Type': 'application/json',
				},
				body: JSON.stringify(data),
			});

			if (response.ok) {
				alert('Cliente creado exitosamente');
				window.location.href = '/crud/clientes';
			} else {
				const error = await response.text();
				alert('Error al crear el cliente: ' + error);
			}
		} catch (error) {
			console.error('Error:', error);
			alert('Error al conectar con el servidor');
		}
	});
</script>

